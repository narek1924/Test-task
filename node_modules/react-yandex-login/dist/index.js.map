{"version":3,"file":"index.js","sources":["../src/YandexLogout.js","../src/YandexHiddenFrame.js","../src/YandexLogin.js"],"sourcesContent":["import React from 'react';\n\nexport default function YandexLogout(props) {\n  const onClick = () => {\n    sessionStorage.setItem('yandexAutoLoginDisabled', 'true');\n    props.onSuccess();\n  };\n\n  return (\n    <div>\n        { React.cloneElement( props.children, { onClick: onClick } ) }\n    </div>\n  );\n}","import React from 'react';\n\nexport default function YandexHiddenFrame(props) {\n  return (\n    <iframe hidden title=\"yandex-hidden-frame\" src={props.redirectTo}></iframe>\n  );\n}","import React, { useEffect } from 'react';\nimport YandexHiddenFrame from './YandexHiddenFrame';\n// import logo from './yandex_login.png';\n\nfunction checkAccessKey() {\n  const parts = window.location.href.split('#')\n  const queryPartUrl = parts.length > 1 && parts[1] !== 'frame' ? parts[1] : null;\n  if (!queryPartUrl) {\n    return null;\n  }\n  var result = {};\n  queryPartUrl.split(\"&\").forEach(function (part) {\n    var item = part.split(\"=\");\n    result[item[0]] = decodeURIComponent(item[1]);\n  });\n  return result;\n}\n\nfunction getYandexAuthUrl(clientID, redirectUrl) {\n  let requestUrl = 'https://oauth.yandex.ru/authorize?response_type=token&client_id=' + clientID;\n  requestUrl += '&redirect_uri=' + encodeURIComponent(redirectUrl);\n  requestUrl += '&display=popup';\n  return requestUrl;\n}\n\nfunction getCurrentUrl() {\n  let currentUrl = window.location.origin;\n  if (currentUrl[currentUrl.length - 1] === '/') {\n    currentUrl = currentUrl.slice(0, currentUrl.length - 1)\n  }\n  return currentUrl;\n}\n\nexport default function YandexLogin(props) {\n  const handleMessageFromPopup = (event) => {\n    if (event.data.source === 'yandex-login') {\n      props.onSuccess(event.data.payload);\n    }\n  }\n\n  const onClick = () => {\n    sessionStorage.setItem('yandexAutoLoginDisabled', 'false');\n    let currentUrl = getCurrentUrl();\n    const requestUrl = getYandexAuthUrl(props.clientID, currentUrl)\n\n    const h = 650;\n    const w = 550;\n    const y = window.top.outerHeight / 2 + window.top.screenY - (h / 2);\n    const x = window.top.outerWidth / 2 + window.top.screenX - (w / 2);\n    window.open(requestUrl, 'popup', `width=${w},height=${h},top=${y},left=${x}`);\n\n    window.addEventListener('message', handleMessageFromPopup, { once: true });\n  }\n\n  let frameRedirectTo = null;\n\n  const aki = checkAccessKey();\n  const receiver = window.parent !== window\n    ? window.parent\n    : window.opener;\n\n  useEffect(() => {\n    if (aki && receiver) {\n      receiver.postMessage({\n        source: 'yandex-login',\n        payload: aki\n      }, window.location.origin);\n      \n      window.close();\n    }\n  });\n\n  \n\n  if (!aki && !receiver) {\n    const autoLoginDIsabled = sessionStorage.getItem('yandexAutoLoginDisabled');\n\n    frameRedirectTo = autoLoginDIsabled !== 'true' \n      ? getYandexAuthUrl(props.clientID, getCurrentUrl())\n      : null;\n    \n    window.addEventListener('message', handleMessageFromPopup, { once: false });\n  }\n\n  return (\n    <div>\n      { React.cloneElement( props.children, { onClick: onClick } ) }\n      {/* <img src={logo} alt=\"yandex\" onClick={onClick} className=\"yandex-login-button\" /> */}\n      {frameRedirectTo && <YandexHiddenFrame redirectTo={frameRedirectTo} />}\n    </div>\n  );\n}"],"names":["YandexLogout","props","onClick","sessionStorage","setItem","onSuccess","React","cloneElement","children","YandexHiddenFrame","redirectTo","checkAccessKey","parts","window","location","href","split","queryPartUrl","length","result","forEach","part","item","decodeURIComponent","getYandexAuthUrl","clientID","redirectUrl","requestUrl","encodeURIComponent","getCurrentUrl","currentUrl","origin","slice","YandexLogin","handleMessageFromPopup","event","data","source","payload","h","w","y","top","outerHeight","screenY","x","outerWidth","screenX","open","addEventListener","once","frameRedirectTo","aki","receiver","parent","opener","useEffect","postMessage","close","autoLoginDIsabled","getItem"],"mappings":"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"}